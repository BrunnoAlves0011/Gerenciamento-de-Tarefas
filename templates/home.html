<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gerenciador de Tarefas</title>
    <link rel="stylesheet" href="/static/css/home.css">
    <script src="/static/js/toast.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <div class="user-info">
                <a href="/home/perfil" style="text-decoration: none; cursor: pointer;">
                    <div class="avatar" style="transition: transform 0.3s ease;"
                        onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                        {{ user[0:2] | upper }}
                    </div>
                </a>
                <div>
                    <h1>OlÃ¡, {{ user }}! ğŸ‘‹</h1>
                    <p class="welcome-text">{{ data_atual | capitalize }}</p>
                </div>
            </div>
            <div class="quick-actions">
                <button class="btn btn-secondary" onclick="viewHelp()">
                    ğŸ’¡ Ajuda
                </button>
                <button class="btn btn-primary" onclick="createTask()">
                    â• Nova Tarefa
                </button>
                <button class="btn btn-secondary" onclick="viewAllTasks()">
                    ğŸ“‹ Ver Todas
                </button>
                <button class="btn btn-config" onclick="viewConfig()">
                    âš™ï¸ ConfiguraÃ§Ãµes
                </button>
                <button class="btn btn-primary" onclick="logout()">
                    Sair
                </button>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- Tarefas de Hoje -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“… Tarefas de Hoje</h2>
                    <span class="badge">{{ count_hoje }} tarefa{% if count_hoje != 1 %}s{% endif %}</span>
                </div>
                <ul class="task-list">
                    {% if tarefas_hoje %}
                    {% for tarefa in tarefas_hoje %}
                    <li class="task-item {% if tarefa.status == 'ConcluÃ­da' %}completed{% elif tarefa.prioridade == 'Alta' %}urgent{% endif %}"
                        onclick="viewTask(event, '{{ tarefa.id }}')">
                        <div class="task-title">{{ tarefa.titulo }}</div>
                        <div class="task-meta">

                            {% if tarefa.categoria.value == 'Trabalho' %}
                            <span>ğŸ’¼ {{ tarefa.categoria.value }}</span>
                            {% elif tarefa.categoria.value == 'Estudos' %}
                            <span>ğŸ“š {{ tarefa.categoria.value }}</span>
                            {% elif tarefa.categoria.value == 'Pessoal' %}
                            <span>ğŸ™â€â™‚ï¸ {{ tarefa.categoria.value }}</span>
                            {% else %}
                            <span>ğŸ“ {{ tarefa.categoria.value }}</span>
                            {% endif %}

                            {% if tarefa.status == 'ConcluÃ­da' %}
                            <span>âœ… ConcluÃ­da</span>
                            {% elif tarefa.prioridade.value == 'Urgente' %}
                            <span>ğŸ”´ Urgente</span>
                            {% elif tarefa.prioridade.value == 'Alta' %}
                            <span>ğŸŸ  Alta</span>
                            {% elif tarefa.prioridade.value == 'Media' %}
                            <span>ğŸ”µ MÃ©dia</span>
                            {% elif tarefa.prioridade.value == 'Baixa' %}
                            <span>ğŸŸ¢ Baixa</span>
                            {% else %}
                            <span>ğŸ“ {{ tarefa.status }}</span>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                    {% else %}
                    <li class="task-item">
                        <div class="task-title" style="text-align: center; color: #888;">
                            Nenhuma tarefa para hoje ğŸ‰
                        </div>
                    </li>
                    {% endif %}
                </ul>
            </div>

            <!-- Tarefas da Semana -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“† Esta Semana</h2>
                    <span class="badge">{{ count_semana }} tarefa{% if count_semana != 1 %}s{% endif %}</span>
                </div>
                <ul class="task-list">
                    {% if tarefas_semana %}
                    {% for tarefa in tarefas_semana %}
                    <li class="task-item {% if tarefa.prioridade == 'Alta' %}urgent{% endif %}"
                        onclick="viewTask(event, '{{ tarefa.id }}')">
                        <div class="task-title">{{ tarefa.titulo }}</div>
                        <div class="task-meta">

                            {% if tarefa.categoria.value == 'Trabalho' %}
                            <span>ğŸ’¼ {{ tarefa.categoria.value }}</span>
                            {% elif tarefa.categoria.value == 'Estudos' %}
                            <span>ğŸ“š {{ tarefa.categoria.value }}</span>
                            {% elif tarefa.categoria.value == 'Pessoal' %}
                            <span>ğŸ™â€â™‚ï¸ {{ tarefa.categoria.value }}</span>
                            {% else %}
                            <span>ğŸ“ {{ tarefa.categoria.value }}</span>
                            {% endif %}

                            {% if tarefa.prioridade.value == 'Urgente' %}
                            <span>ğŸ”´ Urgente</span>
                            {% elif tarefa.prioridade.value == 'Alta' %}
                            <span>ğŸŸ  Alta</span>
                            {% elif tarefa.prioridade.value == 'Media' %}
                            <span>ğŸ”µ MÃ©dia</span>
                            {% elif tarefa.prioridade.value == 'Baixa' %}
                            <span>ğŸŸ¢ Baixa</span>
                            {% else %}
                            <span>ğŸ“ {{ tarefa.status }}</span>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                    {% else %}
                    <li class="task-item">
                        <div class="task-title" style="text-align: center; color: #888;">
                            Nenhuma tarefa esta semana ğŸ‰
                        </div>
                    </li>
                    {% endif %}
                </ul>
            </div>

            <!-- Progresso Geral -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“Š Progresso Geral</h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ tarefas|length }}</div>
                        <div class="stat-label">TOTAL</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ tarefas | selectattr('concluido', 'equalto', False) | list | length
                            }}</div>
                        <div class="stat-label">PENDENTES</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ tarefas | selectattr('concluido', 'equalto', True) | list | length
                            }}</div>
                        <div class="stat-label">CONCLUÃDAS</div>
                    </div>
                </div>
                <div class="progress-section">
                    <div class="progress-item">
                        <div class="progress-label">
                            <span><strong>Trabalho</strong></span>
                            <span>{{ ((tarefas | selectattr('categoria.value', 'equalto', 'Trabalho') | list | length) /
                                (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"
                                style="width: {{ ((tarefas | selectattr('categoria.value', 'equalto', 'Trabalho') | list | length) / (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%">
                            </div>
                        </div>
                    </div>

                    <div class="progress-item">
                        <div class="progress-label">
                            <span><strong>Pessoal</strong></span>
                            <span>{{ ((tarefas | selectattr('categoria.value', 'equalto', 'Pessoal') | list | length) /
                                (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"
                                style="width: {{ ((tarefas | selectattr('categoria.value', 'equalto', 'Pessoal') | list | length) / (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%">
                            </div>
                        </div>
                    </div>

                    <div class="progress-item">
                        <div class="progress-label">
                            <span><strong>Estudos</strong></span>
                            <span>{{ ((tarefas | selectattr('categoria.value', 'equalto', 'Estudos') | list | length) /
                                (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"
                                style="width: {{ ((tarefas | selectattr('categoria.value', 'equalto', 'Estudos') | list | length) / (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%">
                            </div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span><strong>Outros</strong></span>
                            <span>{{ ((tarefas | selectattr('categoria.value', 'equalto', '') | list | length) /
                                (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"
                                style="width: {{ ((tarefas | selectattr('categoria.value', 'equalto', '') | list | length) / (tarefas|length) * 100) | round(1) if tarefas|length > 0 else 0 }}%">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function logout() {
            try {
                const response = await fetch('/logout', {
                    method: 'GET'
                });

                if (response.ok) {
                    console.log('Logout realizado com sucesso!');
                    window.location.reload();
                } else {
                    console.error('Erro ao fazer logout:', response.status);
                    alert('Erro ao fazer logout. Tente novamente.');
                }
            } catch (error) {
                console.error('Erro na requisiÃ§Ã£o:', error);
                alert('Erro de conexÃ£o. Verifique sua internet.');
            }
        }

        function createTask() {
            window.location.href = '/home/adicionar_tarefa';
        }

        function viewAllTasks() {
            window.location.href = '/home/tarefas_lista';
        }

        function viewHelp() {
            window.location.href = '/home/ajuda';
        }

        function viewConfig() {
            window.location.href = '/config';
        }

        function viewTask(event, taskId) {
            if (event) {
                event.preventDefault();
            }

            window.location.href = `/home/tarefa_visualizar/${taskId}`;
        }

        window.addEventListener('load', function () {
            document.querySelectorAll('.progress-fill').forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0';
                setTimeout(() => {
                    bar.style.width = width;
                }, 100);
            });
        });
    </script>
</body>

</html>