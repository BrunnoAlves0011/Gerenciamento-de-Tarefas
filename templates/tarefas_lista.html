<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todas as Tarefas - Gerenciador de Tarefas</title>
    <link rel="stylesheet" href="/static/css/taf_lista.css">
    <script src="/static/js/toast.js"></script>
    <script src="/static/js/script_taf_lista.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div style="display: flex; align-items: center; gap: 20px;">
                    <button class="back-btn" onclick="goBack()">
                        ← Voltar
                    </button>
                    <h1>📋 Todas as Tarefas</h1>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="createTask()">
                        ➕ Nova Tarefa
                    </button>
                </div>
            </div>
        </header>

        <div class="content-area">
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-number">{{ tarefas|length }}</div>
                    <div class="stat-label">Total de Tarefas</div>
                </div>
                <div class="stat-box completed">
                    <div class="stat-number">{{ tarefas | selectattr('concluido', 'equalto', True) | list | length }}
                    </div>
                    <div class="stat-label">Concluídas</div>
                </div>
                <div class="stat-box pending">
                    <div class="stat-number">{{ tarefas | selectattr('concluido', 'equalto', False)| list | length }}
                    </div>
                    <div class="stat-label">Pendentes</div>
                </div>
                <div class="stat-box urgent">
                    <div class="stat-number">{{ tarefas | selectattr('prioridade', 'equalto', 'Urgente')| list | length
                        }}</div>
                    <div class="stat-label">Urgentes</div>
                </div>
            </div>

            <div class="tasks-container" id="tasksContainer">
                <!-- Inicio tarefas -->
                {% for tarefa in tarefas %}
                {% if tarefa.concluido == False %}
                <!-- Tarefas Urgentes -->
                {% if tarefa.prioridade == 'Urgente' %}
                <div class="task-card urgent" data-task-id="{{ tarefa.id }}" data-status="pending"
                    data-priority="urgent" data-category="trabalho">
                    <div class="task-header">
                        <div class="task-main">
                            <div class="task-title">{{ tarefa.titulo }}</div>
                            <div class="task-description">{{ tarefa.descricao }}</div>
                            <div class="task-meta">
                                <div class="meta-item">📅 {{ tarefa.data }}</div>
                                <div class="meta-item">
                                    <span class="priority-badge priority-urgent">{{ tarefa.prioridade }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="category-badge">
                                        {% if tarefa.categoria == 'Trabalho' %}
                                        💼
                                        {% elif tarefa.categoria == 'Pessoal' %}
                                        🙍‍♂️
                                        {% elif tarefa.categoria == 'Estudos' %}
                                        📚
                                        {% else %}
                                        📍
                                        {% endif %}
                                        {{ tarefa.categoria.value }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn complete" onclick="completeTask(this)" title="Concluir">✓</button>
                            <button class="action-btn edit" onclick="editTask(this)" title="Editar">✏️</button>
                            <button class="action-btn delete" onclick="deleteTask(this)" title="Excluir">🗑️</button>
                        </div>
                    </div>
                </div>

                {% elif tarefa.prioridade == 'Alta' %}
                <div class="task-card" data-task-id="{{ tarefa.id }}" data-status="pending" data-priority="high"
                    data-category="trabalho">
                    <div class="task-header">
                        <div class="task-main">
                            <div class="task-title">{{ tarefa.titulo }}</div>
                            <div class="task-description">{{ tarefa.descricao }}</div>
                            <div class="task-meta">
                                <div class="meta-item">📅 {{ tarefa.data }}</div>
                                <div class="meta-item">
                                    <span class="priority-badge priority-high">{{ tarefa.prioridade.value }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="category-badge">
                                        {% if tarefa.categoria == 'Trabalho' %}
                                        💼
                                        {% elif tarefa.categoria == 'Pessoal' %}
                                        🙍‍♂️
                                        {% elif tarefa.categoria == 'Estudos' %}
                                        📚
                                        {% else %}
                                        📍
                                        {% endif %}
                                        {{ tarefa.categoria.value }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn complete" onclick="completeTask(this)" title="Concluir">✓</button>
                            <button class="action-btn edit" onclick="editTask(this)" title="Editar">✏️</button>
                            <button class="action-btn delete" onclick="deleteTask(this)" title="Excluir">🗑️</button>
                        </div>
                    </div>
                </div>

                {% elif tarefa.prioridade == 'Media' %}
                <div class="task-card" data-task-id="{{ tarefa.id }}" data-status="pending" data-priority="medium"
                    data-category="estudos">
                    <div class="task-header">
                        <div class="task-main">
                            <div class="task-title">{{ tarefa.titulo }}</div>
                            <div class="task-description">{{ tarefa.descricao }}</div>
                            <div class="task-meta">
                                <div class="meta-item">📅 {{ tarefa.data }}</div>
                                <div class="meta-item">
                                    <span class="priority-badge priority-medium">{{ tarefa.prioridade.value }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="category-badge">
                                        {% if tarefa.categoria == 'Trabalho' %}
                                        💼
                                        {% elif tarefa.categoria == 'Pessoal' %}
                                        🙍‍♂️
                                        {% elif tarefa.categoria == 'Estudos' %}
                                        📚
                                        {% else %}
                                        📍
                                        {% endif %}
                                        {{ tarefa.categoria.value }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn complete" onclick="completeTask(this)" title="Concluir">✓</button>
                            <button class="action-btn edit" onclick="editTask(this)" title="Editar">✏️</button>
                            <button class="action-btn delete" onclick="deleteTask(this)" title="Excluir">🗑️</button>
                        </div>
                    </div>
                </div>

                {% elif tarefa.prioridade == 'Baixa' %}
                <div class="task-card" data-task-id="{{ tarefa.id }}" data-status="pending" data-priority="low"
                    data-category="{{ tarefa.categoria }}">
                    <div class="task-header">
                        <div class="task-main">
                            <div class="task-title">{{ tarefa.titulo }}</div>
                            <div class="task-description">{{ tarefa.descricao }}</div>
                            <div class="task-meta">
                                <div class="meta-item">📅 Quinta - 20:00</div>
                                <div class="meta-item">
                                    <span class="priority-badge priority-low">{{ tarefa.prioridade.value }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="category-badge">
                                        {% if tarefa.categoria == 'Trabalho' %}
                                        💼
                                        {% elif tarefa.categoria == 'Pessoal' %}
                                        🙍‍♂️
                                        {% elif tarefa.categoria == 'Estudos' %}
                                        📚
                                        {% else %}
                                        📍
                                        {% endif %}
                                        {{ tarefa.categoria.value }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn complete" onclick="completeTask(this)" title="Concluir">✓</button>
                            <button class="action-btn edit" onclick="editTask(this)" title="Editar">✏️</button>
                            <button class="action-btn delete" onclick="deleteTask(this)" title="Excluir">🗑️</button>
                        </div>
                    </div>
                </div>

                {% endif %} <!-- case prioridade -->
                {% endif %} <!-- if concluido == false -->
                {% endfor %} <!-- for tarefas in tarefa -->
                {% for tarefa in tarefas if tarefa.concluido %}
                <div class="task-card completed" data-task-id="{{ tarefa.id }}" data-status="completed"
                    data-priority="{{ tarefa.prioridade.value.lower() }}"
                    data-category="{{ tarefa.categoria.value.lower() }}">
                    <div class="task-header">
                        <div class="task-main">
                            <div class="task-title">{{ tarefa.titulo }}</div>
                            <div class="task-description">{{ tarefa.descricao }}</div>
                            <div class="task-meta">
                                {% if tarefa.data %}
                                <div class="meta-item">📅 {{ tarefa.data }}</div>
                                {% endif %}
                                <div class="meta-item">
                                    <span class="priority-badge priority-{{ tarefa.prioridade.value.lower() }}">
                                        {{ tarefa.prioridade.value }}
                                    </span>
                                </div>
                                <div class="meta-item">
                                    <span class="category-badge">
                                        {% if tarefa.categoria.value == 'Trabalho' %}💼
                                        {% elif tarefa.categoria.value == 'Pessoal' %}👤
                                        {% elif tarefa.categoria.value == 'Estudos' %}📚
                                        {% elif tarefa.categoria.value == 'Saude' %}❤️
                                        {% endif %}
                                        {{ tarefa.categoria.value }}
                                    </span>
                                </div>
                                <div class="meta-item">✅ Concluída</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <!-- Não mostra botão de concluir em tarefas já concluídas -->
                            <button class="action-btn edit" onclick="editTask(this)" title="Editar">✏️</button>
                            <button class="action-btn delete" onclick="deleteTask(this)" title="Excluir">🗑️</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <!-- Fim tarefas -->
            </div>
        </div>
    </div>
</body>

</html>